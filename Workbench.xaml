<Window x:Class="LogicLink.Corona.Workbench"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:winformchart="clr-namespace:System.Windows.Forms.DataVisualization.Charting;assembly=System.Windows.Forms.DataVisualization"
        xmlns:local="clr-namespace:LogicLink.Corona"
        xmlns:gl="clr-namespace:System.Globalization;assembly=mscorlib"
        xmlns:s="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Corona SEIR Workbench" 
        Icon="Corona.ico"
        Height="700" Width="900"
        Loaded="Workbench_Loaded">
    <Window.DataContext>
        <local:WorkbenchViewModel /> 
    </Window.DataContext>
    
    <Window.Resources>
        <s:Double x:Key="LabelMinWidth">70</s:Double>
        <s:Double x:Key="FieldWidth">100</s:Double>
        
        <Style x:Key="RightLabelStyle" TargetType="{x:Type Label}" BasedOn="{StaticResource {x:Type Label}}">
            <Setter Property="MinWidth" Value="{StaticResource LabelMinWidth}" />
            <Setter Property="HorizontalContentAlignment" Value="Right" />
        </Style>
        
        <Style x:Key="NumericTextBoxStyle" TargetType="{x:Type TextBox}" BasedOn="{StaticResource {x:Type TextBox}}">
            <Setter Property="Width" Value="{StaticResource FieldWidth}" />
            <Setter Property="HorizontalContentAlignment" Value="Right" />
        </Style>
        
        <Style x:Key="DatePickerStyle" TargetType="{x:Type DatePicker}" BasedOn="{StaticResource {x:Type DatePicker}}">
            <Setter Property="Width" Value="{StaticResource FieldWidth}" />
        </Style>

    </Window.Resources>
    
    <Grid Margin="3" Grid.IsSharedSizeScope="True">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />   <!-- Label Country -->
            <ColumnDefinition Width="Auto" />   <!-- Country -->
            <ColumnDefinition Width="*" MinWidth="{StaticResource LabelMinWidth}" />   <!-- Label Population -->
            <ColumnDefinition Width="Auto" />      <!-- Population -->
            <ColumnDefinition Width="*" MinWidth="{StaticResource LabelMinWidth}" />   <!-- Label Infectious -->
            <ColumnDefinition Width="Auto" />      <!-- Infectious -->
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <WindowsFormsHost Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="10" x:Name="wfh">
            <winformchart:Chart x:Name="cht" Dock="Fill">
                <winformchart:Chart.Series>
                    <winformchart:Series Name="Default" ChartType="Area"/>
                </winformchart:Chart.Series>
                <winformchart:Chart.ChartAreas>
                    <winformchart:ChartArea/>
                </winformchart:Chart.ChartAreas>
            </winformchart:Chart>
        </WindowsFormsHost>
        <TextBox          Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="8" x:Name="txt" FontFamily="Courier New" VerticalScrollBarVisibility="Auto" IsReadOnly="True" Visibility="Collapsed" />

        <Label            Grid.Column="0" Grid.Row="1" Content="Series" Target="{Binding ElementName=gbxViewSEIR}" />
        <Grid             Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="7">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <GroupBox         Grid.Column="0" x:Name="gbxViewSEIR" Header="SEIR">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <CheckBox         Grid.Column="0" Grid.Row="0" Content="Susceptible" IsChecked="{Binding ShowSusceptible}" />
                    <CheckBox         Grid.Column="0" Grid.Row="1" Content="Exposed" IsChecked="{Binding ShowExposed}" />
                    <CheckBox         Grid.Column="0" Grid.Row="2" Content="Infectious" IsChecked="{Binding ShowInfectious}" />
                    <CheckBox         Grid.Column="0" Grid.Row="3" Content="Removed" IsChecked="{Binding ShowRemoved}" />
                    <CheckBox         Grid.Column="0" Grid.Row="4" Content="Cases" IsChecked="{Binding ShowCases}" />
                    
                    <CheckBox         Grid.Column="1" Grid.Row="0" Content="Daily" IsChecked="{Binding ShowDaily}" />
                    <CheckBox         Grid.Column="1" Grid.Row="1" Content="7 Days Incidence" IsChecked="{Binding Show7Days}" />
                    <CheckBox         Grid.Column="1" Grid.Row="3" Content="Reproduction R₀" IsChecked="{Binding ShowReproduction}" />
                    <CheckBox         Grid.Column="1" Grid.Row="4" Content="&#x25c7; Marker for doubled cases" IsChecked="{Binding ShowDoubledMarker}" />
                </Grid>
            </GroupBox>

            <GroupBox         Grid.Column="1" Header="Johns Hopkins University">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <CheckBox         Grid.Column="0" Grid.Row="0" Content="Confirmed" IsChecked="{Binding ShowConfirmed}" />
                    <CheckBox         Grid.Column="0" Grid.Row="1" Content="Daily Confirmed" IsChecked="{Binding ShowDailyConfirmed}" />
                    <CheckBox         Grid.Column="0" Grid.Row="2" Content="7 Days Incidence Confirmed" IsChecked="{Binding Show7DaysConfirmed}" />
                    <CheckBox         Grid.Column="0" Grid.Row="3" Content="Recovered" IsChecked="{Binding ShowRecovered}" />
                    <CheckBox         Grid.Column="0" Grid.Row="4" Content="Deaths" IsChecked="{Binding ShowDeaths}" />
                </Grid>
            </GroupBox>
        
            <GroupBox         Grid.Column="2" Header="Robert Koch Institut">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <CheckBox         Grid.Column="0" Grid.Row="0" Content="Nowcasting R₀" IsChecked="{Binding ShowNowcasting}" />
                    <CheckBox         Grid.Column="0" Grid.Row="1" Content="Nowcasting 7-Day-R₀" IsChecked="{Binding ShowNowcasting7Day}" />
                </Grid>
            </GroupBox>
        </Grid>
        
        <Label            Grid.Column="0" Grid.Row="2" Content="Country" Target="{Binding ElementName=cmbCountry}" />
        <ComboBox         Grid.Column="1" Grid.Row="2" x:Name="cmbCountry"
                          SelectedItem="{Binding Country, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true }"
                          ItemsSource="{Binding Countries, Source={x:Static local:Settings.Default}}" />

        <Label            Grid.Column="2" Grid.Row="2" Content="Population" Target="{Binding ElementName=txtPopulation}" Style="{StaticResource RightLabelStyle}" />
        <TextBox          Grid.Column="3" Grid.Row="2" x:Name="txtPopulation"
                          Text="{Binding Population, StringFormat={}{0:N0}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          Style="{StaticResource NumericTextBoxStyle}" />

        <Label            Grid.Column="4" Grid.Row="2" Content="Infectious" Target="{Binding ElementName=txtInfectious}"  Style="{StaticResource RightLabelStyle}" />
        <TextBox          Grid.Column="5" Grid.Row="2" x:Name="txtInfectious"
                          Text="{Binding Infectious, StringFormat={}{0:N0}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          Style="{StaticResource NumericTextBoxStyle}" />

        <Label            Grid.Column="0" Grid.Row="3" Content="Start" Target="{Binding ElementName=dtpStart}" />
        <DatePicker       Grid.Column="1" Grid.Row="3" x:Name="dtpStart"
                          SelectedDate="{Binding Start, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          Style="{StaticResource DatePickerStyle}" />

        <Label            Grid.Column="2" Grid.Row="3" Content="End" Target="{Binding ElementName=dtpEnd}"  Style="{StaticResource RightLabelStyle}" />
        <DatePicker       Grid.Column="3" Grid.Row="3" x:Name="dtpEnd"
                          SelectedDate="{Binding End, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}" 
                          Style="{StaticResource DatePickerStyle}" />

        <Label            Grid.Column="0" Grid.Row="4" Content="Incubation Period" Target="{Binding ElementName=txtIncubationPeriod}" />
        <TextBox          Grid.Column="1" Grid.Row="4" x:Name="txtIncubationPeriod"
                          Text="{Binding Value, ElementName=slIncubationPeriod, StringFormat={}{0:N1}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}" 
                          Style="{StaticResource NumericTextBoxStyle}" />
        <Slider           Grid.Column="2" Grid.Row="4" Grid.ColumnSpan="4" x:Name="slIncubationPeriod"
                          Value="{Binding IncubationPeriod, Converter={x:Static local:TimeSpanToDaysDoubleConverter.Instance}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          TickPlacement="BottomRight" IsSnapToTickEnabled="True" TickFrequency=".1" Maximum="10" 
                          AutoToolTipPlacement="BottomRight" AutoToolTipPrecision="1" />

        <Label            Grid.Column="0" Grid.Row="5" Content="Infectious Period" Target="{Binding ElementName=txtInfectiousPeriod}" />
        <TextBox          Grid.Column="1" Grid.Row="5" x:Name="txtInfectiousPeriod"
                          Text="{Binding Value, ElementName=slInfectiousPeriod, StringFormat={}{0:N1}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}" 
                          Style="{StaticResource NumericTextBoxStyle}" />
        <Slider           Grid.Column="2" Grid.Row="5" Grid.ColumnSpan="4" x:Name="slInfectiousPeriod"
                          Value="{Binding InfectiousPeriod, Converter={x:Static local:TimeSpanToDaysDoubleConverter.Instance}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          TickPlacement="BottomRight" IsSnapToTickEnabled="True" TickFrequency=".1" Maximum="10" 
                          AutoToolTipPlacement="BottomRight" AutoToolTipPrecision="1" />

        <Label            Grid.Column="0" Grid.Row="6" Content="Basic Reproduction Number (R₀)" Target="{Binding ElementName=txtReproduction}" />
        <TextBox          Grid.Column="1" Grid.Row="6" x:Name="txtReproduction"
                          Text="{Binding Value, ElementName=slReproduction, StringFormat={}{0:N1}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          Style="{StaticResource NumericTextBoxStyle}" />
        <Slider           Grid.Column="2" Grid.Row="6" Grid.ColumnSpan="4" x:Name="slReproduction"
                          Value="{Binding Reproduction, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                          TickPlacement="BottomRight" IsSnapToTickEnabled="True" TickFrequency=".1" Maximum="10"
                          AutoToolTipPlacement="BottomRight" AutoToolTipPrecision="1" />

        <CheckBox         Grid.Column="1" Grid.Row="7" Content="Calc R₀ from JHE:" IsChecked="{Binding SolveR0}" VerticalAlignment="Center" />
        <Grid             Grid.Column="2" Grid.Row="7" Grid.ColumnSpan="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" SharedSizeGroup="A" />
                <ColumnDefinition Width="Auto" SharedSizeGroup="B" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Label   Grid.Column="0" Content="Residual Window" Target="{Binding ElementName=slSolveR0ResidualDayWindow}" />
            <TextBox Grid.Column="1" Grid.Row="6" x:Name="txtSolveR0ResidualDayWindow"
                     Text="{Binding Value, ElementName=slSolveR0ResidualDayWindow, StringFormat={}{0:N0}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                     Style="{StaticResource NumericTextBoxStyle}" 
                     IsEnabled="{Binding SolveR0}" />
            <Slider  Grid.Column="2" x:Name="slSolveR0ResidualDayWindow"
                     Value="{Binding SolveR0ResidualDayWindow, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                     TickPlacement="BottomRight" IsSnapToTickEnabled="True" Minimum="1" TickFrequency="1" Maximum="10" 
                     AutoToolTipPlacement="BottomRight" AutoToolTipPrecision="0" 
                     IsEnabled="{Binding SolveR0}" />
            
        </Grid>
        
        <CheckBox         Grid.Column="1" Grid.Row="8" Content="Calc R₀ from JHE:" IsChecked="{Binding SolveR0Interval}" VerticalAlignment="Center" />
        <Grid             Grid.Column="2" Grid.Row="8" Grid.ColumnSpan="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" SharedSizeGroup="A" />
                <ColumnDefinition Width="Auto" SharedSizeGroup="B" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Label   Grid.Column="0" Content="Interval" Target="{Binding ElementName=slSolveR0Interval}" />
            <TextBox Grid.Column="1" Grid.Row="6" x:Name="txtSolveR0Interval"
                     Text="{Binding Value, ElementName=slSolveR0Interval, StringFormat={}{0:N0}, ConverterCulture={x:Static gl:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                     Style="{StaticResource NumericTextBoxStyle}" 
                     IsEnabled="{Binding SolveR0Interval}" />
            <Slider  Grid.Column="2" x:Name="slSolveR0Interval"
                     Value="{Binding SolveR0IntervalDays, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, ValidatesOnDataErrors=true, NotifyOnValidationError=true}"
                     TickPlacement="BottomRight" IsSnapToTickEnabled="True" Minimum="1" TickFrequency="1" Maximum="30" 
                     AutoToolTipPlacement="BottomRight" AutoToolTipPrecision="0" 
                     IsEnabled="{Binding SolveR0Interval}" />
            
        </Grid>

        <StackPanel Grid.Column="0" Grid.Row="9" Grid.ColumnSpan="6" Orientation="Horizontal">
            <Button Margin="3" Padding="15,3,15,3" MinWidth="120" Click="btnData_Click" IsEnabled="{Binding Visibility, ElementName=pbr, Converter={x:Static local:VisibilityToNotBooleanConverter.Instance}}">Show Data</Button>
            <Button Margin="3" Padding="15,3,15,3" MinWidth="120" Click="btnExport_Click" IsEnabled="{Binding Visibility, ElementName=pbr, Converter={x:Static local:VisibilityToNotBooleanConverter.Instance}}">Export Chart</Button>
        </StackPanel>
        <StackPanel Grid.Column="0" Grid.Row="9" Grid.ColumnSpan="6" Orientation="Horizontal" FlowDirection="RightToLeft" >
            <Button Margin="3" Padding="15,3,15,3" MinWidth="120" Click="btnClear_Click">Clear Settings</Button>
            <Button Margin="3" Padding="15,3,15,3" MinWidth="120" Click="btnReset_Click">Reset Settings</Button>
            <Button Margin="3" Padding="15,3,15,3" MinWidth="120" Click="btnSave_Click">Save Settings</Button>
        </StackPanel>

        <StatusBar  Grid.Column="0" Grid.Row="10" Grid.ColumnSpan="6">
            <StatusBarItem>
                <ProgressBar x:Name="pbr" Minimum="0" Maximum="100" Width="200" Height="15" Visibility="Collapsed" />
            </StatusBarItem>
            <StatusBarItem x:Name="sbi" MinHeight="19" Content="Ready" />
        </StatusBar>
    </Grid>

</Window>
